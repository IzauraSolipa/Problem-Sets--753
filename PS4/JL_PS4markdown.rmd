---
title: "753 Problem Set 4"
author: "Jesús Lara"
date: "11/9/2020"
output:
  pdf_document: default
  html_document: default
---

# Flow of Funds Accounting

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
load("Table2.Rdata")
load("TableA.Rdata")
```

In this part we analyze the evolution of the relationship between the flow of liabilities, internal funds and fixed investment for the US non-financial corporate businesses over the last 70 years. We  use the flow of funds accounting data provided by the FED. We calculate the net increase in liabilities by subtracting net lending/borrowing from net increase in assets. 

The ratios of Internal Funds and Net increase in liabilities to Fixed Investment are presented in Figure 1. The first salient fact is that for most of the period, the Internal Funds/Fixed Investment ratio fluctuates very closely to 1, which means that for every dollar of profit that is retained by the firm (that is, after taxes, dividends and other payments), almost one dollar is transformed into new fixed capital. That can also be seen in Figure 2, where we show the time series of the variables instead of the ratios to Fixed Investment. There we see that Internal Funds and Fixed Investment move together together until the late 1990s, when a big gap opens between the two.
```{r,  fig.cap="Relation between fixed Investment, Internal funds and liabilities", out.width = '100%',fig.align = 'center'}
knitr::include_graphics("PS4plot1.png")
```

```{r,  fig.cap="Relation between fixed Investment, Internal funds and liabilities", out.width = '100%',fig.align = 'center'}
knitr::include_graphics("PS4plot2.png")
```

Secondly, maybe the most important fact that emerges from the figures is that, from 1962, the Internal Funds/Fixed investment and Net increase in liabilities/Fixed Investment ratios move in opposite directions. The intuition can work in two directions. On the one hand, when the availability of cash flows generated by the firms fall, they must make use of credit to keep the pace investment, which represents an increase in their liabilities. Alternatively, one could say that when financial markets are tight (due to high interest rates or instabilities), both liabilities and fixed investment fall, rising the Internal Funds-Investment ratio. 

The dynamics can be seen better in Figure 2. There, we observe that the increase in liabilities is by far the most volatile variable and, secondly, that specially in the last 22 years, very sharp net increases in liabilities have not necessarily been followed by higher Fixed Investment, but by a substitution of Internal funds as a source of investment. Also, these sharp increases in net liabilities have been followed by abrupt falls, which also caused a substantial decreases in investment. This is the case in the early 2000s (with the dot-com bubble) and the 2008 crisis. The net increase in liabilities becomes zero or even negative in these cases, which represents the partial or total temporary collapse of credit markets. Hence, we may say that financial markets conditions, by affecting the source of funding decisions of firms, contribute substantially to the volatility of investment, and given that investment is the most volatile component of GDP, they are a very important determinant of the dynamics of economic cycles.  Although here we don't have data on the Q ratio ($=\frac{MarketValue}{ReplacementValue}$), it seems to be a very important determinant of investment as it is an indicator of over and undervaluation of firms. Hence, if there are factors associated to financial markets distorting, for example, the market value of firms, these will have an effect on investment and thus on the real economic activity. 

\pagebreak

# Advances on Replication

I have made some progress on cleaning the data in order to get the same descriptive statistics as the authors. I present my results in Tables 1 and 2. Table 1 describes the treatment variable, which are the Rules of Origin applied to the different inputs. There we can see that a great share of inputs in every 2-digits category is subject to Rules of Origin from NAFTA. However, it is in the chemicals and textiles industries where are more ROO


```{r}
library(knitr)
library(kableExtra)

kbl(TableA, booktabs=T, digits=2, caption="Descriptive statistics on NAFTA RoO")  %>% 
  add_header_above(c(" ", "Panel A. RoO1"=3), align="c") %>% kable_styling(position="center") 

```

In Table 2 I add to the trade descriptive statistics that summary of the Most Favored Nation tariffs applied by Mexico, before and after NAFTA. The most interesting fact is that the MFN tariffs rose for all categories of goods, which illustrates the main point of the paper that the NAFTA area is very protectionist towards the rest of the world.

My results are exactly the same for trade, but are slightly different for rules of origin and tariffs. I am identifying the key steps by following the authors' Stata code. 

```{r}
library(knitr)
library(kableExtra)

kbl(Table2, booktabs=T, digits=2, caption="Descriptive statistics on Imports and Tariffs")  %>% 
  add_header_above(c(" ", 
                     "Mexican imports non-NAFTA "=2, 
                     "Mexican imports NAFTA"=2, "Tariffs Applied by Mexico"=2), align="c") %>% kable_styling(position="center",latex_options = "scale_down") 

```

\pagebreak

# R code

```{r eval=FALSE, echo=T}

#Econ 753
#PS4
#Jesús Lara

library(dplyr)
library(tidyr)
library(data.table)
library(ggplot2)
library("rio")
library(matlib)
library(gdata)
library(tinytex)
library(car)
library(scales)
library(ggplot2)
library(foreign)
library(rmarkdown)
library(fastDummies)
library(haven)
library(pmdplyr)
library(plotrix)
library(foreign)
library(stringr)


options(scipen=10000)
options(digits=4)

rm(list=ls())

setwd("C:/Users/User/Documents/GitHub/Problem-Sets--753/PS4")

# PART 2 #

data<-import("FRB_Z1.csv")
data<-data %>% slice(-c(1:5))
data<-data %>% mutate(across(everything(),as.numeric))

names<-colnames(data)
names<-str_replace_all(names, "Nonfinancial corporate business; ","")
names<-str_replace_all(names," ", ".")
names<-str_replace_all(names, ";", "_")
colnames(data)<-names

data<-data %>% 
  rename("Total_internal_funds"=
           "gross.saving.including.foreign.earnings.retained.abroad.less.net.capital.transfers.paid",
                      "FI"="gross.fixed.investment",
                      "Net_acquisition_assets"=
           "total.financial.assets",
                      "Net_lending_borrowing"=
           "net.lending.(+).or.borrowing.(-).(financial.account)",
                      "year"="Series.Description") 

data<-data %>%
  select(year, Total_internal_funds, FI, 
         Net_acquisition_assets, Net_lending_borrowing)
data<-data %>% 
  mutate(Net_increase_liabilities=Net_acquisition_assets-Net_lending_borrowing)
data<-data %>% 
  mutate(IF.FI.ratio=Total_internal_funds/FI, 
         NIL.FI.ratio=Net_increase_liabilities/FI)

plot1<-ggplot(data, aes(x=year))+ 
  geom_line(aes(y=IF.FI.ratio,color="x"),size=1)+
  geom_line(aes(y=NIL.FI.ratio,color="y"),size=1) + 
  theme_bw() + xlab("Year") +ylab("Ratio") + 
  scale_color_discrete(name="Flow Type",
                       labels=c("Internal Funds/Fixed Investment", 
                                "Net Increase in Liabilities/ Fixed Investment"))+
  theme(legend.position = "bottom")
  
plot1<-plot1+scale_x_continuous(breaks=c(1950,1960,1970,1980,1990,2000,2010,2020))
  
plot1
ggsave("PS4plot1.png")


plot2<-ggplot(data, aes(x=year))+ theme_bw()+
  geom_line(aes(y=Total_internal_funds,color="wheat"),size=1)+
  geom_line(aes(y=Net_increase_liabilities, color="green4"),size=1)+
  geom_line(aes(y=FI, color="green5"),size=1)+
  xlab("Year")+ylab("Flow")+
  scale_x_continuous(breaks=c(1950,1960,1970,1980,1990,2000,2010,2020))+
  scale_color_discrete(name="Flow Type",labels=c("Net Increase in Liabilities",
                                                 "Fixed Investment", "Internal Funds"))+
  theme(legend.position = "bottom")
plot2
ggsave("PS4plot2.png")

ggplot(data, aes(x=year))+ theme_bw()+
  geom_line(aes(y=Total_internal_funds,color="wheat"),size=1)+
  scale_x_continuous(breaks=c(1950,1960,1970,1980,1990,2000,2010,2020))+
  theme(legend.position = "bottom")


```

